<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1067px" preserveAspectRatio="none" style="width:916px;height:1067px;" version="1.1" viewBox="0 0 916 1067" width="916px" zoomAndPan="magnify"><defs><filter height="300%" id="f1tf55ayjq23bt" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="419" x="249.5" y="23.5352">Simplified sequence of events for ZKP transaction finality</text><rect fill="#FFFFFF" filter="url(#f1tf55ayjq23bt)" height="318.7266" style="stroke: #000000; stroke-width: 2.0;" width="652" x="23" y="128.2871"/><rect fill="#FFFFFF" filter="url(#f1tf55ayjq23bt)" height="548.5898" style="stroke: #000000; stroke-width: 2.0;" width="892" x="13" y="461.0137"/><rect fill="#FFFFFF" filter="url(#f1tf55ayjq23bt)" height="318.7266" style="stroke: #000000; stroke-width: 2.0;" width="872" x="23" y="569.9453"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="69" x2="69" y1="68.9766" y2="1026.6035"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="453.5" x2="453.5" y1="68.9766" y2="1026.6035"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="669.5" x2="669.5" y1="68.9766" y2="1026.6035"/><rect fill="#FEFECE" filter="url(#f1tf55ayjq23bt)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="68" x="33" y="33.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="40" y="54.0234">Initiator</text><rect fill="#FEFECE" filter="url(#f1tf55ayjq23bt)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="68" x="33" y="1025.6035"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="40" y="1046.1387">Initiator</text><rect fill="#FEFECE" filter="url(#f1tf55ayjq23bt)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="105" x="399.5" y="33.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="91" x="406.5" y="54.0234">Counterparty</text><rect fill="#FEFECE" filter="url(#f1tf55ayjq23bt)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="105" x="399.5" y="1025.6035"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="91" x="406.5" y="1046.1387">Counterparty</text><rect fill="#FEFECE" filter="url(#f1tf55ayjq23bt)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="59" x="638.5" y="33.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="645.5" y="54.0234">Notary</text><rect fill="#FEFECE" filter="url(#f1tf55ayjq23bt)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="59" x="638.5" y="1025.6035"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="645.5" y="1046.1387">Notary</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="69" x2="111" y1="100.2871" y2="100.2871"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="111" x2="111" y1="100.2871" y2="113.2871"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="70" x2="111" y1="113.2871" y2="113.2871"/><polygon fill="#A80036" points="80,109.2871,70,113.2871,80,117.2871,76,113.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="312" x="76" y="95.5449">stx = ZKTransactionBuilder.toSignedTransaction()</text><path d="M23,128.2871 L232,128.2871 L232,135.2871 L222,145.2871 L23,145.2871 L23,128.2871 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="318.7266" style="stroke: #000000; stroke-width: 2.0;" width="652" x="23" y="128.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="164" x="38" y="141.8555">ZKCollectSignaturesFlow</text><polygon fill="#A80036" points="442,162.9082,452,166.9082,442,170.9082,446,166.9082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="69" x2="448" y1="166.9082" y2="166.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="20" x="76" y="162.166">stx</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="454" x2="496" y1="232.9951" y2="232.9951"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="496" x2="496" y1="232.9951" y2="245.9951"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="455" x2="496" y1="245.9951" y2="245.9951"/><polygon fill="#A80036" points="465,241.9951,455,245.9951,465,249.9951,461,245.9951" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="461" y="228.2529">ZKResolveTransactionsFlow(stx)</text><path d="M199,179.9082 L199,280.9082 L445,280.9082 L445,189.9082 L435,179.9082 L199,179.9082 " fill="#FBFB77" filter="url(#f1tf55ayjq23bt)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M435,179.9082 L435,189.9082 L445,189.9082 L435,179.9082 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="205" y="197.4766">The ZKResolveTransactionsFlow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="205" y="212.7871">does not collect and verify</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="205" y="228.0977">a chain of SignedTransactions.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="209" y="243.4082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="205" y="258.7188">It collects and verifies a chain</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="205" y="274.0293">of FilteredTransactions with proofs.</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="454" x2="496" y1="312.082" y2="312.082"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="496" x2="496" y1="312.082" y2="325.082"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="455" x2="496" y1="325.082" y2="325.082"/><polygon fill="#A80036" points="465,321.082,455,325.082,465,329.082,461,325.082" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="59" x="461" y="307.3398">stx.verify</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="454" x2="496" y1="354.3926" y2="354.3926"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="496" x2="496" y1="354.3926" y2="367.3926"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="455" x2="496" y1="367.3926" y2="367.3926"/><polygon fill="#A80036" points="465,363.3926,455,367.3926,465,371.3926,461,367.3926" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="461" y="349.6504">sig = stx.sign()</text><polygon fill="#A80036" points="80,392.7031,70,396.7031,80,400.7031,76,396.7031" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="74" x2="453" y1="396.7031" y2="396.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="19" x="86" y="391.9609">sig</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="69" x2="111" y1="426.0137" y2="426.0137"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="111" x2="111" y1="426.0137" y2="439.0137"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="70" x2="111" y1="439.0137" y2="439.0137"/><polygon fill="#A80036" points="80,435.0137,70,439.0137,80,443.0137,76,439.0137" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="371" x="76" y="421.2715">fullySignedTx = SignedTransaction + TransactionSignature</text><path d="M13,461.0137 L154,461.0137 L154,468.0137 L144,478.0137 L13,478.0137 L13,461.0137 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="548.5898" style="stroke: #000000; stroke-width: 2.0;" width="892" x="13" y="461.0137"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="96" x="28" y="474.582">ZKFinalityFlow</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="69" x2="111" y1="499.6348" y2="499.6348"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="111" x2="111" y1="499.6348" y2="512.6348"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="70" x2="111" y1="512.6348" y2="512.6348"/><polygon fill="#A80036" points="80,508.6348,70,512.6348,80,516.6348,76,512.6348" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="196" x="76" y="494.8926">proof = prove(fullySignedTx)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="69" x2="111" y1="541.9453" y2="541.9453"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="111" x2="111" y1="541.9453" y2="554.9453"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="70" x2="111" y1="554.9453" y2="554.9453"/><polygon fill="#A80036" points="80,550.9453,70,554.9453,80,558.9453,76,554.9453" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="76" y="537.2031">ftx = buildFilteredTx(fullySignedTx)</text><path d="M23,569.9453 L160,569.9453 L160,576.9453 L150,586.9453 L23,586.9453 L23,569.9453 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="318.7266" style="stroke: #000000; stroke-width: 2.0;" width="872" x="23" y="569.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="92" x="38" y="583.5137">ZKNotaryFlow</text><polygon fill="#A80036" points="658,604.5664,668,608.5664,658,612.5664,662,608.5664" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="69" x2="664" y1="608.5664" y2="608.5664"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="76" y="603.8242">send(Payload(ftx, proof))</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="670" x2="712" y1="674.6533" y2="674.6533"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="712" x2="712" y1="674.6533" y2="687.6533"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="671" x2="712" y1="687.6533" y2="687.6533"/><polygon fill="#A80036" points="681,683.6533,671,687.6533,681,691.6533,677,687.6533" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="206" x="677" y="669.9111">ZKResolveTransactionsFlow(ftx)*</text><path d="M415,621.5664 L415,722.5664 L661,722.5664 L661,631.5664 L651,621.5664 L415,621.5664 " fill="#FBFB77" filter="url(#f1tf55ayjq23bt)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M651,621.5664 L651,631.5664 L661,631.5664 L651,621.5664 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="421" y="639.1348">The ZKResolveTransactionsFlow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="421" y="654.4453">does not collect and verify</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="421" y="669.7559">a chain of SignedTransactions.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="425" y="685.0664"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="421" y="700.377">It collects and verifies a chain</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="421" y="715.6875">of FilteredTransactions with proofs.</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="670" x2="712" y1="753.7402" y2="753.7402"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="712" x2="712" y1="753.7402" y2="766.7402"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="671" x2="712" y1="766.7402" y2="766.7402"/><polygon fill="#A80036" points="681,762.7402,671,766.7402,681,770.7402,677,766.7402" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="57" x="677" y="748.998">ftx.verify</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="670" x2="712" y1="796.0508" y2="796.0508"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="712" x2="712" y1="796.0508" y2="809.0508"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="671" x2="712" y1="809.0508" y2="809.0508"/><polygon fill="#A80036" points="681,805.0508,671,809.0508,681,813.0508,677,809.0508" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="85" x="677" y="791.3086">verify(proof)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="670" x2="712" y1="838.3613" y2="838.3613"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="712" x2="712" y1="838.3613" y2="851.3613"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="671" x2="712" y1="851.3613" y2="851.3613"/><polygon fill="#A80036" points="681,847.3613,671,851.3613,681,855.3613,677,851.3613" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="196" x="677" y="833.6191">notarySig = commitInputStates</text><polygon fill="#A80036" points="80,876.6719,70,880.6719,80,884.6719,76,880.6719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="74" x2="669" y1="880.6719" y2="880.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="86" y="875.9297">NotarySig</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="69" x2="111" y1="916.9824" y2="916.9824"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="111" x2="111" y1="916.9824" y2="929.9824"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="70" x2="111" y1="929.9824" y2="929.9824"/><polygon fill="#A80036" points="80,925.9824,70,929.9824,80,933.9824,76,929.9824" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="260" x="76" y="912.2402">notarisedStx = fullySignedTx + notarySig</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="69" x2="111" y1="959.293" y2="959.293"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="111" x2="111" y1="959.293" y2="972.293"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="70" x2="111" y1="972.293" y2="972.293"/><polygon fill="#A80036" points="80,968.293,70,972.293,80,976.293,76,972.293" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="282" x="76" y="954.5508">serviceHub.recordTransactions(notarisedStx)</text><polygon fill="#A80036" points="442,997.6035,452,1001.6035,442,1005.6035,446,1001.6035" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="69" x2="448" y1="1001.6035" y2="1001.6035"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="76" y="996.8613">send(notarisedStx)</text><!--
@startuml
title Simplified sequence of events for ZKP transaction finality
skinparam backgroundColor white



Init as "Initiator" -> Init: stx = ZKTransactionBuilder.toSignedTransaction()
group ZKCollectSignaturesFlow
    Init -> ctp as "Counterparty": stx
    ctp -> ctp: ZKResolveTransactionsFlow(stx)
    note left
        The ZKResolveTransactionsFlow
        does not collect and verify
        a chain of SignedTransactions.

        It collects and verifies a chain
        of FilteredTransactions with proofs.
    end note
    ctp -> ctp: stx.verify
    ctp -> ctp: sig = stx.sign()
    ctp -> Init: sig
    Init -> Init: fullySignedTx = SignedTransaction + TransactionSignature
end

group ZKFinalityFlow
    Init -> Init: <font color=red><b>proof = prove(fullySignedTx)</b></font>
    Init -> Init: ftx = buildFilteredTx(fullySignedTx)
    group ZKNotaryFlow
        Init -> notary as "Notary":  send(Payload(ftx, proof))
        notary -> notary: ZKResolveTransactionsFlow(ftx)*
        note left
            The ZKResolveTransactionsFlow
            does not collect and verify
            a chain of SignedTransactions.

            It collects and verifies a chain
            of FilteredTransactions with proofs.
        end note
        notary -> notary: ftx.verify
        notary -> notary: <font color=red><b>verify(proof)</b></font>
        notary -> notary: notarySig = commitInputStates
        notary -> Init: NotarySig
    end
    Init -> Init: notarisedStx = fullySignedTx + notarySig
    Init -> Init: serviceHub.recordTransactions(notarisedStx)
    Init -> ctp: send(notarisedStx)
end
@enduml

PlantUML version 1.2019.07(Mon Jun 24 21:59:20 CEST 2019)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_232-b18
Operating System: Mac OS X
OS Version: 10.15.7
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>